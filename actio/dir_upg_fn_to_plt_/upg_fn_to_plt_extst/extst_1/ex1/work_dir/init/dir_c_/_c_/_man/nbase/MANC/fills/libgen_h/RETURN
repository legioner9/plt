Функции dirname() и basename() возвращают указатели на строки, оканчивающиеся null (не передавайте эти указатели free(3)).