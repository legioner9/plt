Функция mmap() используется для сопоставления адресного пространства процесса с файлами или устройствами. Когда файл сопоставляется с адресным пространством процесса, к файлу можно обращаться как к массиву в программе. Это один из наиболее эффективных способов доступа к данным в файле и обеспечивает бесшовный интерфейс кодирования, который является естественным для структуры данных, которую можно оценивать без абстрагирования чтения и записи из файлов. В этой статье мы обсудим, как использовать функцию mmap() в Linux. Итак, давайте начнем.

Аргументы:
Функция принимает 6 аргументов:

1. адрес:
Этот аргумент дает предпочтительный начальный адрес для сопоставления. Если другого сопоставления там не существует, ядро выберет ближайшую границу страницы и создаст сопоставление; в противном случае ядро выбирает новый адрес. Если этот аргумент равен NULL, то ядро может разместить отображение в любом месте, где сочтет нужным.

2. длина:
Это количество байтов, которые должны быть сопоставлены.

3. защита:
Этот аргумент используется для управления тем, какой доступ разрешен. Этот аргумент может быть логическим "ИЛИ" из следующих флагов PROT_READ | PROT_WRITE | PROT_EXEC | PROT_NONE. Типы доступа для чтения, записи и выполнения - это разрешения на содержимое.

4. флаги:
Этот аргумент используется для управления характером карты. Ниже приведены некоторые общие значения флагов:

MAP_SHARED: этот флаг используется для совместного использования сопоставления со всеми другими процессами, которые сопоставлены с этим объектом. Изменения, внесенные в область сопоставления, будут записаны обратно в файл.
MAP_PRIVATE: когда используется этот флаг, отображение не будет видно никаким другим процессам, и внесенные изменения не будут записаны в файл.
MAP_ANONYMOUS / MAP_ANON: этот флаг используется для создания анонимного сопоставления. Анонимное сопоставление означает, что сопоставление не связано ни с какими файлами. Это отображение используется в качестве основного примитива для расширения кучи.
MAP_FIXED: когда используется этот флаг, система должна быть вынуждена использовать точный адрес сопоставления, указанный в адресе, если это невозможно, то сопоставление не будет выполнено.
5. файлы:
Это дескриптор файла, который должен быть сопоставлен.

6. смещение:
Это смещение от того места, где началось сопоставление файлов. Проще говоря, сопоставление подключается к (смещение) к (смещение + длина-1) байтам для файла, открытого в дескрипторе filedes.

Возвращаемые значения:
При успешном выполнении mmap() возвращает 0; при сбое функция возвращает MAP_FAILED .

![jpg](../../src/1-22.jpg)